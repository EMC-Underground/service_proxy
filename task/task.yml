---
platform: linux

image_resource:
  type: docker-image
  source:
    repository: eugenmayer/docker-client
    tag: latest

inputs:
  - name: proxy_repo

params:
  DNS_SUFFIX: ((dnssuffix))
  DOCKER_HOST: ((dockerhost))

run:
  path: sh
  args:
  - -c
  - |
    cd proxy_repo
    pip install jinja2
    cat traefik.toml.tmpl | python variables_injector.py > traefik.toml
    docker stack deploy -c docker-compose.yml proxy
